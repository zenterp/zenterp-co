(function(b) {
    function y(g, a) {
        var k, l, m, n;

        function s(c) {
            if (!(e.ratio >= 1)) {
                pastPosition = d.obj.css(i);
                k = Math.min(h[a.axis] - d[a.axis], Math.max(0, l + parseInt(c) + parseInt(pastPosition.replace("px", ""))));
                f = k * m;
                var g = f == 0 ? -180 : 0,
                    j = h[a.axis] - d[a.axis] > Math.max(0, l + parseInt(c) + parseInt(pastPosition.replace("px", ""))) ? 0 : -180;
                b("a.prev").css({
                    left: g
                });
                b("a.next").css({
                    right: j
                });
                e.obj.css(i, -f);
                d.obj.css(i, k);
                t = setTimeout(function() {
                    s(c)
                }, 10)
            }
            return !1
        }
        function w() {
            clearTimeout(t);
            t = 0
        }
        function x(a) {
            q.start = o ? a.pageX : a.pageY;
            a = parseInt(d.obj.css(i));
            l = a == "auto" ? 0 : a;
            b(document).bind("mousemove", r);
            document.ontouchmove = function(a) {
                b(document).unbind("mousemove");
                r(a.touches[0])
            };
            b(document).bind("mouseup", p);
            d.obj.bind("mouseup", p);
            d.obj[0].ontouchend = document.ontouchend = function(a) {
                b(document).unbind("mouseup");
                d.obj.unbind("mouseup");
                p(a.touches[0])
            };
            return !1
        }
        function u(c) {
            if (!(e.ratio >= 1)) {
                c = b.event.fix(c || window.event);
                f -= (c.wheelDelta ? c.wheelDelta / 120 : -c.detail / 3) * a.wheel;
                f = Math.min(e[a.axis] - j[a.axis], Math.max(0, f));
                d.obj.css(i, f / m);
                var g = f == 0 ? -180 : 0,
                    h = e[a.axis] - j[a.axis] > Math.max(0, f) ? 0 : -180;
                b("a.prev").css({
                    left: g
                });
                b("a.next").css({
                    right: h
                });
                e.obj.css(i, -f);
                c.preventDefault()
            }
        }
        function p() {
            b(document).unbind("mousemove", r);
            b(document).unbind("mouseup", p);
            d.obj.unbind("mouseup", p);
            document.ontouchmove = d.obj[0].ontouchend = document.ontouchend = null;
            return !1
        }
        function r(c) {
            if (!(e.ratio >= 1)) {
                k = Math.min(h[a.axis] - d[a.axis], Math.max(0, l + ((o ? c.pageX : c.pageY) - q.start)));
                f = k * m;
                var g = f == 0 ? -180 : 0,
                    c = h[a.axis] - d[a.axis] > Math.max(0, l + ((o ? c.pageX : c.pageY) - q.start)) ? 0 : -180;
                b("a.prev").css({
                    left: g
                });
                b("a.next").css({
                    right: c
                });
                e.obj.css(i, -f);
                d.obj.css(i, k)
            }
            return !1
        }
        var j = {
            obj: b(".viewport", g)
        },
            e = {
                obj: b(".overview", g)
            };
        n = b(".scrollbar", g);
        m = void 0;
        var h = {
            obj: b(".track", n)
        },
            d = {
                obj: b(".thumb", n)
            },
            o = a.axis == "x",
            i = o ? "left" : "top",
            v = o ? "Width" : "Height",
            f;
        l = 0;
        k = 0;
        var q = {},
            t = 0;
        this.update = function(c) {
            j[a.axis] = j.obj[0]["offset" + v];
            e[a.axis] = e.obj[0]["scroll" + v];
            e.ratio = j[a.axis] / e[a.axis];
            e.ratio >= 1 && (b("a.prev").css({
                left: -180
            }), b("a.next").css({
                right: -180
            }));
            n.toggleClass("disable", e.ratio >= 1);
            h[a.axis] = a.size == "auto" ? j[a.axis] - 20 : a.size;
            d[a.axis] = Math.min(h[a.axis], Math.max(0, a.sizethumb == "auto" ? h[a.axis] * e.ratio : a.sizethumb));
            m = a.sizethumb == "auto" ? e[a.axis] / h[a.axis] : (e[a.axis] - j[a.axis]) / (h[a.axis] - d[a.axis]);
            f = c == "relative" && e.ratio <= 1 ? Math.min(e[a.axis] - j[a.axis], Math.max(0, f)) : 0;
            f = c == "bottom" && e.ratio <= 1 ? e[a.axis] - j[a.axis] : isNaN(parseInt(c)) ? f : parseInt(c);
            d.obj.css(i, f / m);
            e.obj.css(i, -f);
            q.start = d.obj.offset()[i];
            c = v.toLowerCase();
            n.css(c, h[a.axis] + 20);
            h.obj.css(c, h[a.axis]);
            d.obj.css(c, d[a.axis])
        };
        this.update();
        (function() {
            d.obj.bind("mousedown", x);
            d.obj[0].ontouchstart = function(a) {
                a.preventDefault();
                d.obj.unbind("mousedown");
                x(a.touches[0]);
                return !1
            };
            h.obj.bind("mouseup", r);
            if (a.scroll && this.addEventListener) g[0].addEventListener("DOMMouseScroll", u, !1), g[0].addEventListener("mousewheel", u, !1);
            else if (a.scroll) g[0].onmousewheel = u;
            b("a.prev").hover(function() {
                s(-1)
            }, w);
            b("a.next").hover(function() {
                s(1)
            }, w)
        })();
        return this
    }
    b.tiny = b.tiny || {};
    b.tiny.scrollbar = {
        options: {
            axis: "y",
            wheel: 1,
            scroll: !0,
            size: "auto",
            sizethumb: "auto"
        }
    };
    b.fn.tinyscrollbar = function(g) {
        g = b.extend({}, b.tiny.scrollbar.options, g);
        this.each(function() {
            b(this).data("tsb", new y(b(this), g))
        });
        return this
    };
    b.fn.tinyscrollbar_update = function(g) {
        return b(this).data("tsb").update(g)
    }
})(jQuery);